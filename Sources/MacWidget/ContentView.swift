// ============================================================================
// ContentView.swift - 主要畫面視圖
// ============================================================================
// 這個檔案定義了應用程式的使用者介面（UI）
// 使用 SwiftUI 框架，這是 Apple 的現代化 UI 開發工具
// SwiftUI 的特色是用「宣告式」語法來描述介面，而不是一步步建立元件
// ============================================================================

// 匯入 SwiftUI 框架
// SwiftUI 是 Apple 在 2019 年推出的 UI 框架，讓開發者用簡潔的程式碼建立介面
import SwiftUI

// ============================================================================
// ContentView 結構 - 主要內容視圖
// ============================================================================
// 【struct vs class 說明】
// struct（結構）和 class（類別）都是用來定義資料結構的方式
// 主要差異：
// - struct 是「值型別」：複製時會建立完整副本（像複製 Word 文件）
// - class 是「參考型別」：複製時只是建立捷徑（像建立桌面捷徑）
// 在 SwiftUI 中，視圖（View）通常用 struct 定義
//
// 【View 協定說明】
// : View 代表這個結構「遵守 View 協定」
// 協定（Protocol）類似其他語言的「介面」（Interface）
// 遵守 View 協定的意思是：這個結構承諾會提供一個 body 屬性來描述畫面內容
// ============================================================================
struct ContentView: View {
    
    // ========================================================================
    // 【狀態物件】
    // @StateObject 是一個特殊標記，代表這個變數的生命週期由 SwiftUI 管理
    // 
    // 【為什麼需要 @StateObject？】
    // - 當 monitor 裡的資料改變時（例如 CPU 使用率更新）
    // - SwiftUI 會自動偵測到變化
    // - 然後自動重新繪製畫面來顯示新資料
    // - 這就是「響應式 UI」的概念
    //
    // private 代表這個變數只能在 ContentView 內部存取
    // ========================================================================
    @StateObject private var monitor = SystemMonitor()
    
    // ========================================================================
    // 【body 屬性】- 視圖的主體
    // 這裡定義了畫面要顯示什麼內容
    // some View 代表回傳「某種 View」，讓編譯器自動推斷具體型別
    // ========================================================================
    var body: some View {
        
        // ====================================================================
        // VStack - 垂直堆疊容器
        // V = Vertical（垂直）
        // Stack = 堆疊
        // 這個容器會把裡面的元件從上到下排列
        //
        // 參數說明：
        // - alignment: .leading → 靠左對齊（leading 在英文環境是左邊）
        // - spacing: 12 → 每個元件之間間隔 12 點（約 12 像素）
        // ====================================================================
        VStack(alignment: .leading, spacing: 12) {
            
            // 顯示 CPU 負載的那一列
            // StatsRow 是我們自己定義的元件（見下方）
            // icon: "cpu" → 使用系統內建的 CPU 圖示
            // label: "CPU 負載" → 標籤文字
            // value: monitor.cpuUsage → 綁定到監控器的 CPU 使用率資料
            StatsRow(icon: "cpu", label: "CPU 負載", value: monitor.cpuUsage)
            
            // 顯示記憶體使用量的那一列
            // icon: "memorychip" → 使用記憶體晶片圖示
            StatsRow(icon: "memorychip", label: "記憶體", value: monitor.memoryUsage)
            
            // 顯示硬碟使用量的那一列
            // icon: "internaldrive" → 使用內建硬碟圖示
            StatsRow(icon: "internaldrive", label: "硬碟 (總共/已用)", value: monitor.diskUsage)
            
            // 顯示硬碟剩餘空間的那一列
            // icon: "arrow.down.circle" → 使用圓形向下箭頭圖示
            StatsRow(icon: "arrow.down.circle", label: "硬碟剩餘", value: monitor.diskFree)
        }
        // ====================================================================
        // 【修飾器鏈】- 修改視圖外觀的方法
        // SwiftUI 使用「鏈式呼叫」來套用樣式，每個 . 後面的方法都會修改視圖
        // 就像「穿衣服」一樣，一層一層往外加
        // ====================================================================
        
        // 內部邊距（padding）：在內容和邊框之間加入 16 點的空白
        .padding(16)
        
        // 背景設定
        .background(
            // RoundedRectangle：圓角矩形
            // cornerRadius: 16 → 圓角半徑為 16 點
            RoundedRectangle(cornerRadius: 16)
                // .fill(.ultraThinMaterial) → 填充「超薄材質」效果
                // 這是 macOS 特有的「毛玻璃」效果，會模糊背後的畫面
                // 讓視窗看起來有半透明的質感
                .fill(.ultraThinMaterial)
                // 透明度設為 0.8（80% 不透明）
                .opacity(0.8)
        )
        
        // 疊加層（overlay）：在視圖上方疊加額外的元素
        .overlay(
            // 在外圍加一個圓角矩形邊框
            RoundedRectangle(cornerRadius: 16)
                // .stroke → 只畫邊框，不填充
                // Color.white.opacity(0.2) → 20% 不透明度的白色（淡淡的白色邊框）
                // lineWidth: 1 → 邊框寬度 1 點
                .stroke(Color.white.opacity(0.2), lineWidth: 1)
        )
        
        // 外部邊距：在整個視圖外圍加入 10 點的空白
        // 這個空間可以用來顯示陰影或光暈效果
        .padding(10)
        
        // ====================================================================
        // 【右鍵選單】- 讓使用者可以右鍵點擊來關閉應用程式
        // 因為這是一個背景程式（LSUIElement），不會出現在 Dock 中
        // 所以我們需要提供一個方便的方式來關閉它
        // ====================================================================
        .contextMenu {
            Button("結束 MacWidget") {
                NSApplication.shared.terminate(nil)
            }
        }
    }
}

// ============================================================================
// StatsRow 結構 - 統計資料列元件
// ============================================================================
// 這是一個可重複使用的 UI 元件
// 每一列都顯示：圖示 + 標籤 + 數值
// 透過定義這個元件，我們可以避免重複寫相同的程式碼
// ============================================================================
struct StatsRow: View {
    
    // ========================================================================
    // 元件的輸入參數
    // let 代表常數，一旦設定就不能改變
    // 這些參數在建立 StatsRow 時必須提供
    // ========================================================================
    let icon: String    // 圖示名稱（使用 SF Symbols 系統圖示）
    let label: String   // 標籤文字（例如「CPU 負載」）
    let value: String   // 數值文字（例如「45.2%」）
    
    // ========================================================================
    // 視圖主體
    // ========================================================================
    var body: some View {
        
        // HStack - 水平堆疊容器
        // H = Horizontal（水平）
        // 這個容器會把裡面的元件從左到右排列
        HStack {
            
            // ================================================================
            // 圖示區域
            // Image(systemName:) → 使用 SF Symbols 系統圖示
            // SF Symbols 是 Apple 提供的免費圖示庫，包含數千個圖示
            // 官網：https://developer.apple.com/sf-symbols/
            // ================================================================
            Image(systemName: icon)
                // 設定固定寬度 20 點，確保所有圖示對齊
                .frame(width: 20)
                // 設定圖示顏色為白色
                .foregroundColor(.white)
            
            // ================================================================
            // 文字區域
            // 另一個 VStack 用來垂直排列標籤和數值
            // ================================================================
            VStack(alignment: .leading) {
                
                // 標籤文字（較小、較淡的文字）
                Text(label)
                    // .font(.caption) → 使用「註解」字型，比一般文字小
                    .font(.caption)
                    // 設定文字顏色為 80% 不透明的白色（比純白稍淡）
                    .foregroundColor(.white.opacity(0.8))
                
                // 數值文字（較大、較粗的文字）
                Text(value)
                    // .font(.system(.body, design: .monospaced)) 說明：
                    // .body → 使用「內文」大小
                    // .monospaced → 使用等寬字型
                    // 等寬字型的每個字元寬度相同，讓數字排列整齊
                    // 例如：111 和 999 會佔用相同寬度
                    .font(.system(.body, design: .monospaced))
                    // .bold() → 設定為粗體
                    .bold()
                    // 設定文字顏色為純白
                    .foregroundColor(.white)
            }
        }
    }
}
